var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function i(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e){t.appendChild(e)}function u(t,e,n){t.insertBefore(e,n||null)}function c(t){t.parentNode&&t.parentNode.removeChild(t)}function a(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function d(){return f(" ")}function l(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function h(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function p(t,e){e=""+e,t.data!==e&&(t.data=e)}function m(t,e){t.value=null==e?"":e}let y;function g(t){y=t}function w(t){(function(){if(!y)throw new Error("Function called outside component initialization");return y})().$$.on_mount.push(t)}const $=[],v=[];let k=[];const x=[],b=Promise.resolve();let E=!1;function S(t){k.push(t)}const T=new Set;let _=0;function R(){if(0!==_)return;const t=y;do{try{for(;_<$.length;){const t=$[_];_++,g(t),N(t.$$)}}catch(t){throw $.length=0,_=0,t}for(g(null),$.length=0,_=0;v.length;)v.pop()();for(let t=0;t<k.length;t+=1){const e=k[t];T.has(e)||(T.add(e),e())}k.length=0}while($.length);for(;x.length;)x.pop()();E=!1,T.clear(),g(t)}function N(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(S)}}const C=new Set;function A(t,e){t&&t.i&&(C.delete(t),t.i(e))}function D(t,e){t.d(1),e.delete(t.key)}function O(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];k.forEach((o=>-1===t.indexOf(o)?e.push(o):n.push(o))),n.forEach((t=>t())),k=e}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function L(t,e){-1===t.$$.dirty[0]&&($.push(t),E||(E=!0,b.then(R)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function j(r,s,u,a,f,d,l,h=[-1]){const p=y;g(r);const m=r.$$={fragment:null,ctx:[],props:d,update:t,not_equal:f,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(s.context||(p?p.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:s.target||p.$$.root};l&&l(m.root);let w=!1;if(m.ctx=u?u(r,s.props||{},((t,e,...n)=>{const o=n.length?n[0]:e;return m.ctx&&f(m.ctx[t],m.ctx[t]=o)&&(!m.skip_bound&&m.bound[t]&&m.bound[t](o),w&&L(r,t)),e})):[],m.update(),w=!0,o(m.before_update),m.fragment=!!a&&a(m.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);m.fragment&&m.fragment.l(t),t.forEach(c)}else m.fragment&&m.fragment.c();s.intro&&A(r.$$.fragment),function(t,n,r,s){const{fragment:u,after_update:c}=t.$$;u&&u.m(n,r),s||S((()=>{const n=t.$$.on_mount.map(e).filter(i);t.$$.on_destroy?t.$$.on_destroy.push(...n):o(n),t.$$.on_mount=[]})),c.forEach(S)}(r,s.target,s.anchor,s.customElement),R()}g(p)}class M{$destroy(){O(this,1),this.$destroy=t}$on(e,n){if(!i(n))return t;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const t=o.indexOf(n);-1!==t&&o.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function F(t){return Object.keys(t).map((function(e){return function(t,e){if(void 0!==e)return t+"="+encodeURIComponent(e)}(e,t[e])})).filter((function(t){return void 0!==t})).join("&")}function I(t,e){return P((function(n){n.open("POST",t),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(F(e))}))}function P(t){return new Promise((function(e,n){var o=new XMLHttpRequest;o.withCredentials=!0,o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE){var t=o.responseText.length>1?JSON.parse(o.responseText):{};"errors"in t?n(t.errors):o.status>400?n([{message:o.status.toString()}]):e(t.result)}},t(o)}))}var J=!1,z="";function B(){return function(t,e){return P((function(n){n.open("GET",(t+"?"+F(e)).replace(/\?$/,"")),n.send()}))}(U("/session/refresh"),{}).then((function(t){return t.id_token}))}function q(){return function(t){return P((function(e){e.open("DELETE",t),e.send()}))}(U("/session"))}function U(t){if(!z.length)throw"ISSUER not set";return""+z+t}var H=function(){function t(t){this.token=t,this.claims=function(t){try{return JSON.parse(atob(t.split(".")[1]))}catch(t){throw"Malformed JWT: invalid encoding"}}(t)}return t.prototype.iat=function(){return 1e3*this.claims.iat},t.prototype.exp=function(){return 1e3*this.claims.exp},t.prototype.halflife=function(){return(this.exp()-this.iat())/2},t}();var G=function(){function t(){var t=this;"undefined"!=typeof document&&document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&t.scheduleRefresh()}))}return t.prototype.setStore=function(t){this.store=t},t.prototype.sessionToken=function(){if(this.store)return this.store.read()},t.prototype.update=function(t){if(this.store){var e=new H(t);this.store.update(t,e.exp()),this.refreshAt=Date.now()+e.halflife(),this.scheduleRefresh()}},t.prototype.endSession=function(){this.refreshAt=void 0,this.timeoutID&&clearTimeout(this.timeoutID),this.store&&this.store.delete()},t.prototype.restoreSession=function(){var t=this;return new Promise((function(e,n){if(t.store){var o=t.sessionToken();if(o){var i=Date.now(),r=new H(o),s=r.iat()+r.halflife();if(isNaN(s))return t.store.delete(),void n("Malformed JWT: can not calculate refreshAt");i>=s||i<r.iat()?t.refresh().then(e,n):(t.refreshAt=s,t.scheduleRefresh(),e())}else n("No session.")}else n("No session storage available.")}))},t.prototype.refresh=function(){var t=this;return B().then((function(e){return t.update(e)}),(function(e){throw e[0]&&"401"===e[0].message&&t.endSession(),e}))},t.prototype.scheduleRefresh=function(){var t=this;this.timeoutID&&clearTimeout(this.timeoutID),this.refreshAt&&(this.timeoutID=setTimeout((function(){return t.refresh().catch((function(t){if(!t[0]||"401"!==t[0].message)throw t}))}),this.refreshAt-Date.now()))},t}(),W=function(){function t(t,e){void 0===e&&(e={}),this.sessionName=t,this.path=e.path?"; path="+e.path:"",this.domain=e.domain?"; domain="+e.domain:"",this.sameSite=e.sameSite?"; SameSite="+e.sameSite:"",this.useExplicitExpiry=!!e.useExplicitExpiry,"undefined"!=typeof window&&(this.secureFlag="https:"===window.location.protocol?"; secure":"")}return t.prototype.read=function(){if("undefined"!=typeof document)return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+this.sessionName+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")},t.prototype.update=function(t,e){if("undefined"!=typeof document){var n="";if(this.useExplicitExpiry&&e){var o=new Date;o.setTime(e),n="; expires="+o.toUTCString()}document.cookie=this.sessionName+"="+t+this.secureFlag+n+this.path+this.sameSite+this.domain}},t.prototype.delete=function(){"undefined"!=typeof document&&(document.cookie=this.sessionName+"="+this.secureFlag+"; expires=Thu, 01 Jan 1970 00:00:01 GMT;"+this.path+this.sameSite+this.domain)},t}(),X=new G;function K(t,e){var n;n=new W(t,e),X.setStore(n)}function Q(){return X.sessionToken()}function V(t){return function(t){return new Promise((function(e,n){J?n([{message:"duplicate"}]):(J=!0,I(U("/accounts"),t).then((function(t){return e(t.id_token)}),(function(t){return n(t)})).then((function(){return J=!1})))}))}(t).then((function(t){return X.update(t)}))}function Y(t){return function(t){return I(U("/session"),t).then((function(t){return t.id_token}))}(t).then((function(t){return X.update(t)}))}function Z(){return q().then((function(){return X.endSession()}))}const tt="https://api.todoauthn.com/api/v1";function et(t,e,n){const o=t.slice();return o[21]=e[n],o[22]=e,o[23]=n,o}function nt(t){let e,n,i,r,f,p,y,g,w,$,v,k,x,b,E=[],S=new Map,T=t[1];const _=t=>t[21].id;for(let e=0;e<T.length;e+=1){let n=et(t,T,e),o=_(n);S.set(o,E[e]=it(o,n))}return{c(){e=a("main"),n=a("h1"),n.textContent="TODO List",i=d(),r=a("div"),f=a("input"),p=d(),y=a("button"),y.textContent="Add Task",g=d(),w=a("ul");for(let t=0;t<E.length;t+=1)E[t].c();$=d(),v=a("div"),k=a("button"),k.textContent="Logout",h(f,"type","text"),h(f,"placeholder","Enter a new task")},m(o,c){u(o,e,c),s(e,n),s(e,i),s(e,r),s(r,f),m(f,t[2]),s(r,p),s(r,y),s(e,g),s(e,w);for(let t=0;t<E.length;t+=1)E[t]&&E[t].m(w,null);s(e,$),s(e,v),s(v,k),x||(b=[l(f,"input",t[13]),l(y,"click",t[5]),l(k,"click",t[9])],x=!0)},p(t,e){4&e&&f.value!==t[2]&&m(f,t[2]),194&e&&(T=t[1],E=function(t,e,n,i,r,s,u,c,a,f,d,l){let h=t.length,p=s.length,m=h;const y={};for(;m--;)y[t[m].key]=m;const g=[],w=new Map,$=new Map,v=[];for(m=p;m--;){const t=l(r,s,m),o=n(t);let c=u.get(o);c?i&&v.push((()=>c.p(t,e))):(c=f(o,t),c.c()),w.set(o,g[m]=c),o in y&&$.set(o,Math.abs(m-y[o]))}const k=new Set,x=new Set;function b(t){A(t,1),t.m(c,d),u.set(t.key,t),d=t.first,p--}for(;h&&p;){const e=g[p-1],n=t[h-1],o=e.key,i=n.key;e===n?(d=e.first,h--,p--):w.has(i)?!u.has(o)||k.has(o)?b(e):x.has(i)?h--:$.get(o)>$.get(i)?(x.add(o),b(e)):(k.add(i),h--):(a(n,u),h--)}for(;h--;){const e=t[h];w.has(e.key)||a(e,u)}for(;p;)b(g[p-1]);return o(v),g}(E,e,_,1,t,T,S,w,D,it,null,et))},d(t){t&&c(e);for(let t=0;t<E.length;t+=1)E[t].d();x=!1,o(b)}}}function ot(t){let e,n,i,r,y,g,w,$,v,k,x,b,E,S,T,_,R,N,C,A,D,O=t[0]?"Register":"Login",L=t[0]?"Register":"Login";return{c(){e=a("div"),n=a("h2"),i=f(O),r=d(),y=a("form"),g=a("label"),g.textContent="Email:",w=d(),$=a("input"),v=d(),k=a("label"),k.textContent="Password:",x=d(),b=a("input"),E=d(),S=a("button"),T=f(L),_=d(),R=a("label"),N=a("input"),C=f("\n        I'm new here"),h(g,"for","email"),h($,"type","email"),h($,"id","email"),h(k,"for","password"),h(b,"type","password"),h(b,"id","password"),h(N,"type","checkbox")},m(o,c){u(o,e,c),s(e,n),s(n,i),s(e,r),s(e,y),s(y,g),s(y,w),s(y,$),m($,t[3]),s(y,v),s(y,k),s(y,x),s(y,b),m(b,t[4]),s(y,E),s(y,S),s(S,T),s(y,_),s(y,R),s(R,N),N.checked=t[0],s(R,C),A||(D=[l($,"input",t[10]),l(b,"input",t[11]),l(S,"click",t[8]),l(N,"change",t[12])],A=!0)},p(t,e){1&e&&O!==(O=t[0]?"Register":"Login")&&p(i,O),8&e&&$.value!==t[3]&&m($,t[3]),16&e&&b.value!==t[4]&&m(b,t[4]),1&e&&L!==(L=t[0]?"Register":"Login")&&p(T,L),1&e&&(N.checked=t[0])},d(t){t&&c(e),A=!1,o(D)}}}function it(t,e){let n,i,r,y,g,w,$,v,k,x,b,E,S,T=e[21].title+"";function _(){e[14].call(i,e[22],e[23])}function R(){return e[15](e[21])}function N(){e[16].call(y,e[22],e[23])}function C(){return e[17](e[21])}function A(){e[18].call(w,e[22],e[23])}function D(){return e[19](e[21])}function O(){return e[20](e[21])}return{key:t,first:null,c(){n=a("li"),i=a("input"),r=d(),y=a("input"),g=d(),w=a("input"),$=d(),v=f(T),k=d(),x=a("button"),x.textContent="Remove",b=d(),h(i,"type","text"),h(i,"placeholder","Title"),h(y,"type","text"),h(y,"placeholder","Description"),h(w,"type","checkbox"),this.first=n},m(t,o){u(t,n,o),s(n,i),m(i,e[21].title),s(n,r),s(n,y),m(y,e[21].description),s(n,g),s(n,w),w.checked=e[21].completed,s(n,$),s(n,v),s(n,k),s(n,x),s(n,b),E||(S=[l(i,"input",_),l(i,"blur",R),l(y,"input",N),l(y,"blur",C),l(w,"change",A),l(w,"change",D),l(x,"click",O)],E=!0)},p(t,n){e=t,2&n&&i.value!==e[21].title&&m(i,e[21].title),2&n&&y.value!==e[21].description&&m(y,e[21].description),2&n&&(w.checked=e[21].completed),2&n&&T!==(T=e[21].title+"")&&p(v,T)},d(t){t&&c(n),E=!1,o(S)}}}function rt(e){let n;let o=(""===Q()?ot:nt)(e);return{c(){o.c(),n=f("")},m(t,e){o.m(t,e),u(t,n,e)},p(t,[e]){o.p(t,e)},i:t,o:t,d(t){o.d(t),t&&c(n)}}}function st(t,e,n){let o=[],i="";async function r(t,e,n,o){await async function(t,e,n,o){const i=await fetch(`${tt}/todos/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Q()}`},body:JSON.stringify({title:e,description:n,completed:o})});if(i.ok)return await i.json();throw new Error("Failed to update the todo")}(t,e,n,o)}async function s(t){await async function(t){if((await fetch(`${tt}/todos/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Q()}`}})).ok)return!0;throw new Error("Failed to delete the todo")}(t),n(1,o=o.filter((e=>e.id!==t)))}z="https://auth.todoauthn.com/".replace(/\/$/,""),K("todo",{path:"/",sameSite:"None",domain:"todoauthn.com"}),w((async()=>{await X.refresh(),n(1,o=await async function(){const t=await fetch(`${tt}/todos`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${Q()}`}});if(t.ok)return await t.json();throw new Error("Failed to fetch todos")}()??[])}));let{isRegistration:u=!1}=e,c="",a="";return t.$$set=t=>{"isRegistration"in t&&n(0,u=t.isRegistration)},[u,o,i,c,a,async function(){if(i){const t=await async function(t){const e=await fetch(`${tt}/todos`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Q()}`},body:JSON.stringify({title:t})});if(e.ok)return await e.json();throw new Error("Failed to add a todo")}(i);n(1,o=[...o,t]),n(2,i="")}},r,s,async function(){u?await V({username:c,password:a}):await Y({username:c,password:a}),window.location.reload()},async function(){await Z(),window.location.reload()},function(){c=this.value,n(3,c)},function(){a=this.value,n(4,a)},function(){u=this.checked,n(0,u)},function(){i=this.value,n(2,i)},function(t,e){t[e].title=this.value,n(1,o)},t=>r(t.id,t.title,t.description,t.completed),function(t,e){t[e].description=this.value,n(1,o)},t=>r(t.id,t.title,t.description,t.completed),function(t,e){t[e].completed=this.checked,n(1,o)},t=>r(t.id,t.title,t.description,t.completed),t=>s(t.id)]}return new class extends M{constructor(t){super(),j(this,t,st,rt,r,{isRegistration:0})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
